{% extends "tracker/base.html" %}
{% block title %}Currency Converter{% endblock %}
{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1>Currency converter</h1>
        <p class="text-muted">Use this to convert your transaction amounts to different currencies using live exchange rates</p>
    </div>
</div>

<div class="row">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5>Convert amount</h5>
            </div>
            <div class="card-body">
                <form method="get">
                    <div class="mb-3">
                        <label class="form-label">Amount in USD</label>
                        <input type="number"
                               name="amount"
                               class="form-control"
                               step="0.01"
                               value="{{ selected_amount }}"
                               placeholder="100.00">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Convert to</label>
                        <select name="to" class="form-select">
                            {% for currency in currencies %}
                                <option value="{{ currency }}"
                                        {% if currency == selected_currency %}selected{% endif %}>
                                    {{ currency }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary">Convert</button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        {% if error %}
            <div class="alert alert-danger">
                <strong>Error:</strong> {{ error }}
            </div>
        {% endif %}

        {% if result %}
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5>Conversion result</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h2 class="mb-0">
                            {{ result.original_amount }} {{ result.original_currency }}
                        </h2>
                        <p class="text-muted">equals</p>
                        <h2 class="text-success">
                            {{ result.converted_amount }} {{ result.target_currency }}
                        </h2>
                    </div>

                    <hr>

                    <div class="small text-muted">
                        <p class="mb-1">
                            <strong>Exchange Rate:</strong>
                            1 {{ result.original_currency }} = {{ result.exchange_rate }} {{ result.target_currency }}
                        </p>
                        <p class="mb-0">
                            <strong>Last Updated:</strong> {{ result.last_updated }}
                        </p>
                    </div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-body">
                    <h6>Raw API Response:</h6>
                    <pre class="bg-light p-2"><code>{{ result|pprint }}</code></pre>
                </div>
            </div>
        {% endif %}

        {% if not result and not error %}
            <div class="card">
                <div class="card-body text-center text-muted">
                    <i class="bi bi-currency-exchange" style="font-size: 4rem;"></i>
                    <p class="mt-3">Enter an amount and select a currency to see the conversion</p>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>API endpoints</h5>
            </div>
            <div class="card-body">
                <p>Direct JSON API endpoint:</p>
                <code>GET /external/currency/?amount=100&to=EUR</code>

                <p class="mt-3">Try it:</p>
                <a href="{% url 'currency_api' %}?amount=100&to=EUR"
                   target="_blank"
                   class="btn btn-sm btn-outline-primary">
                    View JSON Response
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}